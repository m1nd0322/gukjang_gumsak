# 국장검색 (gukjang_gumsak)

한국 증시 종합 스크리닝 시스템 — FnGuide 데이터 기반 종목 점수화 및 백테스트

## 개요

FnGuide에서 3가지 지표를 크롤링하여 종목별로 점수를 매기고, 고점수 종목에 대해 과거 데이터 기반 백테스트를 수행하는 웹 애플리케이션입니다.

### 스크리닝 기준 (각 1점, 최대 3점)

| 기준 | 설명 |
|------|------|
| 연간실적호전 (턴어라운드) | 연간 실적이 호전된 종목 |
| 외국인/기관 동반 순매수 전환 | 외국인과 기관이 동시에 순매수로 전환한 종목 |
| 국민연금 보유 | 국민연금공단이 보유 중인 종목 |

## 실행 방법

### 요구사항

- Python 3.10+
- Chrome 브라우저 (Selenium headless 크롤링)

### 설치 및 실행

```bash
pip install -r requirements.txt
python app.py
```

- 메인 대시보드: http://localhost:5000
- 백테스트 페이지: http://localhost:5000/backtest

### 자동 갱신

APScheduler가 매일 오전 8시에 FnGuide 데이터를 자동 갱신합니다. 웹 대시보드의 "재조회" 버튼으로 수동 갱신도 가능합니다.

## 백테스트

2점 이상 종목을 대상으로 5가지 전략을 지원합니다:

| 전략 | 설명 |
|------|------|
| 동일 비중 Buy & Hold | 첫 거래일에 동일 금액 매수 후 보유 |
| 월간 리밸런싱 | 20 거래일마다 동일 비중으로 재배분 |
| 변동성 가중 + 트레일링 스탑 | 저변동성 종목에 높은 비중, 고점 대비 하락 시 매도 |
| 이동평균 필터 (MA20) | 종가 > 20일 이동평균일 때만 보유 |
| 복합 전략 | MA 필터 + 변동성 가중 + 트레일링 스탑 결합 |

슬리피지, 거래 수수료, 증권거래세를 반영하며, KOSPI 벤치마크 대비 성과를 비교합니다. 결과는 CSV로 다운로드할 수 있습니다.

## 데이터 저장

- **DuckDB** (`stock_data.duckdb`): 일봉 가격, 종목코드 매핑, KOSPI 지수 데이터를 증분 저장합니다. 이미 수집된 날짜는 pykrx API를 다시 호출하지 않습니다.
- **JSON 캐시** (`cache_data.json`): 마지막 스크리닝 결과를 캐시하여 서버 재시작 시 즉시 로드합니다.

## 프로젝트 구조

```
app.py              # Flask 웹 서버, 크롤링, 스코어링, 백테스트 오케스트레이션
backtester.py       # 커스텀 백테스트 엔진 (외부 의존성 없음)
stock_db.py         # DuckDB 기반 주가 데이터 스토리지
stock_screener.py   # 독립 실행 CLI 버전 (requests 기반, 웹 서버 미사용)
requirements.txt    # Python 의존성
```

## 면책 조항

본 시스템은 투자 참고용이며, 투자의 최종 책임은 투자자 본인에게 있습니다. 백테스트 결과는 현재 스크리닝 결과 기준의 시뮬레이션으로, Look-ahead bias가 존재할 수 있습니다.
